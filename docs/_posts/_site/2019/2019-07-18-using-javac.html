<p>IDE或maven等工具已将Java程序的编译代劳。但工具越高级，隐藏的细节就越多，一旦出现问题就懵逼，归根到底还是基础概念不牢靠。返璞归真，回到最原始的地方<code class="highlighter-rouge">javac</code>，会让问题豁然开朗。下面就一步一步演示用<code class="highlighter-rouge">javac</code>和<code class="highlighter-rouge">java</code>徒手编译运行一个常规工程。</p>

<h1 id="hello-world练个手">Hello World练个手</h1>

<p>来个简单的先，我们祭出祖传的HelloWorld程序。（感兴趣的话，可以试一试徒手是否写的出来~）</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorld</span><span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello, World!"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>写完后，保存为：<code class="highlighter-rouge">HelloWorld.java</code>，然后在当前目录执行<code class="highlighter-rouge">javac</code>编译命令：</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>javac HelloWorld.java
</code></pre></div></div>

<p>查看<strong>当前目录</strong>（更准确的说是java文件同级目录），果然生成了<code class="highlighter-rouge">HelloWorld.class</code>：</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span><span class="nb">ls
</span>HelloWorld.class  HelloWorld.java
</code></pre></div></div>

<p>继续在<strong>当前目录运行</strong><code class="highlighter-rouge">java</code>命令，正确打印出Hello, World!</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>java HelloWorld 
Hello, World!
</code></pre></div></div>

<p>老司机，稳！看起来很简单嘛：先<code class="highlighter-rouge">javac</code>再<code class="highlighter-rouge">java</code>。</p>

<p>虽然简单，但新手通常会犯的一个错：想象成去<strong>执行</strong><code class="highlighter-rouge">.class</code>文件，比如写成这样，自然会报错：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>java HelloWorld.class
Error: Could not find or load main class HelloWorld.class
</code></pre></div></div>

<p>需要明白，<code class="highlighter-rouge">java</code>的参数，<strong>传入的是main函数所在的类的名字，而不是class文件；java会根据类名自动去找class文件</strong>。</p>

<h1 id="带个包名">带个包名</h1>
<p>一切都很顺利，但没有包名是不专业的，所以我们加一个牛逼的包<code class="highlighter-rouge">com.imshuai.javalinux</code>：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">imshuai</span><span class="o">.</span><span class="na">javalinux</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorld</span><span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello, World!"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>还是一样用<code class="highlighter-rouge">javac</code>编译，查看<strong>当前目录</strong>下<code class="highlighter-rouge">HelloWorld.class</code>生成了，很顺利。</p>

<p>还是一样用<code class="highlighter-rouge">java</code>命令，瞬间被打脸：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>java HelloWorld 
Error: Could not find or load main class HelloWorld
</code></pre></div></div>

<p>想了想，<strong>HelloWorld已经有自己的包名了，所以它的名字不在是没有姓氏</strong>的<code class="highlighter-rouge">HelloWorld</code>，新名字叫<code class="highlighter-rouge">com.imshuai.javalinux.HelloWorld</code>，那么传给<code class="highlighter-rouge">java</code>自然要用新名字，再试一试：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>java com.imshuai.javalinux.HelloWorld
Error: Could not find or load main class com.imshuai.javalinux.HelloWorld
</code></pre></div></div>

<p>还是被打脸，这时候老司机告诉你，创建一个<code class="highlighter-rouge">com/imshuai/javalinux</code>目录，然后把<code class="highlighter-rouge">HelloWorld.class</code>放进来，执行：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>mkdir <span class="nt">-p</span> com/imshuai/javalinux
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>mv HelloWorld.class com/imshuai/javalinux
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>java com.imshuai.javalinux.HelloWorld
Hello, World!
</code></pre></div></div>

<p>果然，正常打印出了Hello, World!</p>

<p><strong>上面的步骤，说明了两点：</strong></p>
<ol>
  <li>增加了package名，所以class名也变了，行不改名坐不改姓，自然要带上姓（即所谓全限定名）。</li>
  <li>Java <strong>会根据包名对应出目录结构，并从class path搜索该目录去找class文件</strong>。由于默认的class path是当前目录，所以<code class="highlighter-rouge">com.imshuai.javalinux.HelloWorld</code>必须存储在<code class="highlighter-rouge">./com/imshuai/javalinux/HelloWorld.class</code></li>
</ol>

<p>当然每次自己创建包路径的目录太麻烦。<strong><code class="highlighter-rouge">-d</code>参数可以代劳上面的工作</strong>：</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>javac <span class="nt">-d</span> <span class="nb">.</span> HelloWorld.java 
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span><span class="nb">ls
</span>com  HelloWorld.java
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>java com.imshuai.javalinux.HelloWorld
Hello, World!
</code></pre></div></div>
<p><code class="highlighter-rouge">-d</code>指定了生成class文件的根目录（这里用的是当前目录），并且会根据class的包路径创建子目录。</p>

<h1 id="编译两个有依赖关系的class">编译两个有依赖关系的class</h1>

<p>包名解决了，我们再复杂些，搞个依赖调用。首先，我们抽取一个<code class="highlighter-rouge">HelloService</code>：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">imshuai</span><span class="o">.</span><span class="na">javalinux</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloService</span><span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">printHello</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello, "</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">"!"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>然后修改<code class="highlighter-rouge">HelloWorld.java</code>，调用<code class="highlighter-rouge">HelloService</code>完成say hello：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">imshuai</span><span class="o">.</span><span class="na">javalinux</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorld</span><span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
		<span class="n">HelloService</span> <span class="n">service</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HelloService</span><span class="o">();</span>
		<span class="n">service</span><span class="o">.</span><span class="na">printHello</span><span class="o">(</span><span class="s">"World"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>接着我们依次编译：<code class="highlighter-rouge">HelloService.java </code>和<code class="highlighter-rouge">HelloWorld.java</code>，最后运行：</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>javac <span class="nt">-d</span> <span class="nb">.</span> HelloService.java 
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>javac <span class="nt">-d</span> <span class="nb">.</span> HelloWorld.java 
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span><span class="nb">ls
</span>com  HelloService.java  HelloWorld.java
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>java com.imshuai.javalinux.HelloWorld
Hello, World!
</code></pre></div></div>

<p>直觉上，要先编译<code class="highlighter-rouge">HelloService.java</code>，这是对的。那如果先编译<code class="highlighter-rouge">HelloWorld.java </code>呢？当然是打脸：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>javac <span class="nt">-d</span> <span class="nb">.</span> HelloWorld.java 
HelloWorld.java:4: error: cannot find symbol
		HelloService service <span class="o">=</span> new HelloService<span class="o">()</span><span class="p">;</span>
		^
  symbol:   class HelloService
  location: class HelloWorld
HelloWorld.java:4: error: cannot find symbol
		HelloService service <span class="o">=</span> new HelloService<span class="o">()</span><span class="p">;</span>
		                           ^
  symbol:   class HelloService
  location: class HelloWorld
2 errors
</code></pre></div></div>

<p>如果编译的时候，还要根据依赖关系确定顺序，太low了吧。我觉得<code class="highlighter-rouge">java</code>命令应该能自动解决它，一次性将两个java文件传给它试一试：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>javac <span class="nt">-d</span> <span class="nb">.</span> HelloWorld.java HelloService.java 
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span><span class="nb">ls
</span>com  HelloService.java  HelloWorld.java
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>java com.imshuai.javalinux.HelloWorld
Hello, World!
</code></pre></div></div>

<p>牛逼，它自动解决了顺序问题，赞一个（虽然我不怀好意的将<code class="highlighter-rouge">HelloWorld.java</code>放到了前面）！</p>

<h1 id="使用src和target目录">使用src和target目录</h1>
<p>从上面的例子可以看出，虽然class文件必须放在包名一致的目录里，<strong>但java源文件并没有这个要求</strong>。不过，为了管理方便，我们将java源文件也放在包结构目录里：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>mkdir <span class="nt">-p</span> com/imshuai/javalinux
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>mv <span class="k">*</span>.java com/imshuai/javalinux/
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span><span class="nb">ls </span>com/imshuai/javalinux/
HelloService.java  HelloWorld.java
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>javac <span class="nt">-d</span> <span class="nb">.</span> com/imshuai/javalinux/<span class="k">*</span>.java
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span><span class="nb">ls </span>com/imshuai/javalinux/
HelloService.class  HelloService.java  HelloWorld.class  HelloWorld.java
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>java com.imshuai.javalinux.HelloWorld
Hello, World!
</code></pre></div></div>

<p>编译时<code class="highlighter-rouge">javac</code>要传入新的java文件路径（这里用了通配符），其他也没有什么不同。可以看到<strong>class文件生成到了与java文件相同的目录里</strong>。class文件和java源文件放在一起，很不清爽，能否像IDE里那样：java文件放到src目录，class文件放到target目录？下面我试一试。</p>

<p>先创建src和target目录，并将原来的java文件都移动到src目录：</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>mkdir src
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>mkdir target
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>mv com src
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span><span class="nb">ls
</span>src  target
</code></pre></div></div>

<p>然后编译，<code class="highlighter-rouge">-d</code>参数指定到target目录：</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>javac <span class="nt">-d</span> target src/com/imshuai/javalinux/<span class="k">*</span>.java
maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span><span class="nb">ls </span>target/com/imshuai/javalinux/
HelloService.class  HelloWorld.class
</code></pre></div></div>
<p>怎么运行呢？直接在当前目录运行是不行了，毕竟多了一层target目录，进入target目录运行，妥妥的：</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1/target<span class="nv">$ </span>java com.imshuai.javalinux.HelloWorld
Hello, World!
</code></pre></div></div>

<p>除了进入<code class="highlighter-rouge">target</code>目录以外，更常用的方法是通过<code class="highlighter-rouge">-classpath</code>（或简写为<code class="highlighter-rouge">-cp</code>）选项设置<strong>类路径</strong>：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1$ java -cp target com.imshuai.javalinux.HelloWorld
Hello, World!
</code></pre></div></div>

<h1 id="类路径classpath">类路径CLASSPATH</h1>

<p>上面演示了通过<code class="highlighter-rouge">-cp</code>设置类路径。下面再进一步研究一下类路径。</p>

<p>类路径，是JRE搜索用户级class文件或其他资源的路径，<code class="highlighter-rouge">javac</code>或<code class="highlighter-rouge">java</code>等工具都可以指定类路径。如果没有设置，默认的类路径就是当前目录。<strong>但如果设置了类路径，默认值就被覆盖了，所以如果想保留当前目录为类路径，需要同时将<code class="highlighter-rouge">.</code>加入</strong>，有点像默认构造函数的感觉。</p>

<p>类路径，可以通过环境变量<code class="highlighter-rouge">CLASSPATH</code>或<code class="highlighter-rouge">-cp</code>参数设置，后者会覆盖前者。推荐通过<code class="highlighter-rouge">-cp</code>设置，它只会影响当前进程。</p>

<p>类路径类似操作系统里的<code class="highlighter-rouge">path</code>概念，不过它是java工具搜索class文件的路径。同样的，类路径可以是多个，并通过分号分隔：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export CLASSPATH=path1:path2:...
</code></pre></div></div>

<p>或者：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sdkTool -classpath path1:path2:...
</code></pre></div></div>
<p>sdkTool可以是 java, javac, javadoc等。</p>

<p>类路径不仅可以是目录，还也可以是jar包或zip包。</p>

<p>类路径的设置是有顺序的，java会优先在靠前的类路径里搜索。这一点和操作系统的<code class="highlighter-rouge">path</code>类似。</p>

<p>类路径可以用通配符<code class="highlighter-rouge">*</code>匹配jar或zip，但</p>
<ol>
  <li>通配符只匹配jar或zip，比如path/*只是将下面的jar或zip加入类路径，但path本身不加入类路径。</li>
  <li>通配符不递归搜索，即指匹配第一层目录下的jar或zip。</li>
  <li>通配符匹配到的jar或zip，加入到classpath的顺序是不确定的。因此，更稳妥的做法是显示的枚举所有jar或zip。</li>
  <li>通配符适用于<code class="highlighter-rouge">CLASSPATH</code>变量或<code class="highlighter-rouge">-cp</code>参数，但不适用于jar包的manifest文件。</li>
</ol>

<h1 id="更真实的场景">更真实的场景</h1>

<p>下面的java项目有较多的包结构，<code class="highlighter-rouge">还有jar包依赖</code>，如何编译呢？
(工程代码下载：https://github.com/maoshuai/java-linux-weekly/tree/master/attachment/w1)</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>├── lib
│   ├── logback-classic-1.2.3.jar
│   ├── logback-core-1.2.3.jar
│   └── slf4j-api-1.7.26.jar
├── resources
│   └── logback.xml
├── src
│   └── com
│       └── imshuai
│           └── javalinux
│               ├── HelloWorld.java
│               └── service
│                   ├── IGreetingService.java
│                   └── impl
│                       ├── AlienGreetingService.java
│                       ├── CatGreetingService.java
│                       ├── DogGreetingService.java
│                       └── HumanGreetingService.java
└── target
</code></pre></div></div>

<p>最直接的办法，跟刚才一样，只不过体力活多一些，要枚举所有的java文件，同时使用通配符将lib下的jar加入类路径：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>javac <span class="se">\</span>
<span class="nt">-cp</span> <span class="s2">"lib/*"</span> <span class="se">\</span>
<span class="nt">-d</span> target <span class="se">\</span>
src/com/imshuai/javalinux/HelloWorld.java <span class="se">\</span>
src/com/imshuai/javalinux/service/IGreetingService.java <span class="se">\</span>
src/com/imshuai/javalinux/service/impl/<span class="k">*</span>.java
</code></pre></div></div>

<p>编译成功，<code class="highlighter-rouge">java</code>命令运行一下（注意：target和lib下的jar都需要加入类路径）：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>java <span class="nt">-cp</span> <span class="s2">"target:lib/*"</span> com.imshuai.javalinux.HelloWorld XiaoMing
22:16:15.887 <span class="o">[</span>main] INFO HumanGreetingService - XiaoMing is saying hello: Ni Chou Sha!
</code></pre></div></div>

<p>如果文件很多，手工列出这些文件不太现实，可以通过<code class="highlighter-rouge">find</code>命令完成：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>javac <span class="nt">-cp</span> <span class="s2">"lib/*"</span> <span class="nt">-d</span> target <span class="k">$(</span>find src <span class="nt">-name</span> <span class="s2">"*.java"</span><span class="k">)</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">javac</code>还提供了一种<strong>列表文件</strong>的办法，即将要编译的java文件列表写到一个文本文件里，我们用find命令完成：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maoshuai@ms:~/javaLinux/w1<span class="nv">$ </span>find src <span class="nt">-name</span> <span class="s2">"*.java"</span> <span class="o">&gt;</span>javaFiles.txt
</code></pre></div></div>

<p>生成的javaFiles.txt内容如下：</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src/com/imshuai/javalinux/service/IGreetingService.java
src/com/imshuai/javalinux/service/impl/HumanGreetingService.java
src/com/imshuai/javalinux/service/impl/CatGreetingService.java
src/com/imshuai/javalinux/service/impl/DogGreetingService.java
src/com/imshuai/javalinux/service/impl/AlienGreetingService.java
src/com/imshuai/javalinux/HelloWorld.java
</code></pre></div></div>
<p>然后用<code class="highlighter-rouge">@</code>开头的<code class="highlighter-rouge">@javaFiles.txt</code>，代表传给<code class="highlighter-rouge">javac</code>的是列表文件名：</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>javac <span class="nt">-cp</span> <span class="s2">"lib/*"</span> <span class="nt">-d</span> target @javaFiles.txt
</code></pre></div></div>

<p>不仅如此，参数也可以放入文件（注意：<code class="highlighter-rouge">-cp</code>不能放进去）。比如<code class="highlighter-rouge">javaFiles.txt</code>中加入<code class="highlighter-rouge">-d target</code></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-d</span> target
src/com/imshuai/javalinux/service/IGreetingService.java
src/com/imshuai/javalinux/service/impl/HumanGreetingService.java
src/com/imshuai/javalinux/service/impl/CatGreetingService.java
src/com/imshuai/javalinux/service/impl/DogGreetingService.java
src/com/imshuai/javalinux/service/impl/AlienGreetingService.java
src/com/imshuai/javalinux/HelloWorld.java
</code></pre></div></div>
<p>这样只用执行：</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>javac <span class="nt">-cp</span> <span class="s2">"lib/*"</span>  @javaFiles.txt
</code></pre></div></div>

<p>不过为了清晰，我们可以把参数<code class="highlighter-rouge">-d target</code>单独放到一个文件<code class="highlighter-rouge">javaOptions.txt</code>，然后传两个@文件：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>javac <span class="nt">-cp</span> <span class="s2">"lib/*"</span> @javaOptions.txt  @javaFiles.txt
</code></pre></div></div>
<p><strong>使用列表文件的好处是，规避了命令行参数长度的限制，并且可以在任何操作系统上运行</strong>。</p>

<p>有了上面的准备，我们可以写出一个自动化编译的脚本了：</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">PROJECT_DIR</span><span class="o">=</span>/home/maoshuai/javaLinux/w1
<span class="c"># clean target directory</span>
rm <span class="nt">-rf</span> <span class="nv">$PROJECT_DIR</span>/target/<span class="k">*</span>
<span class="c"># prepare arg files</span>
find <span class="nv">$PROJECT_DIR</span>/src <span class="nt">-name</span> <span class="s2">"*.java"</span><span class="o">&gt;</span><span class="nv">$PROJECT_DIR</span>/target/javaFiles.txt
<span class="nb">echo</span> <span class="s2">"-d </span><span class="nv">$PROJECT_DIR</span><span class="s2">/target"</span> <span class="o">&gt;</span><span class="nv">$PROJECT_DIR</span>/target/javaOptions.txt
<span class="c"># compile</span>
javac <span class="nt">-cp</span> <span class="s2">"</span><span class="nv">$PROJECT_DIR</span><span class="s2">/lib/*"</span> @<span class="nv">$PROJECT_DIR</span>/target/javaOptions.txt @<span class="nv">$PROJECT_DIR</span>/target/javaFiles.txt
<span class="c"># copy resources to target</span>
cp <span class="nt">-rf</span> <span class="nv">$PROJECT_DIR</span>/resources/<span class="k">*</span> <span class="nv">$PROJECT_DIR</span>/target
<span class="c"># clean temp files</span>
rm <span class="nt">-rf</span> <span class="nv">$PROJECT_DIR</span>/target/javaOptions.txt <span class="nv">$PROJECT_DIR</span>/target/javaFiles.txt
</code></pre></div></div>

<h1 id="是时候仔细看一下javac了">是时候仔细看一下javac了</h1>
<p>Oracle的<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/javac.html">官方文档介绍<code class="highlighter-rouge">javac</code>如下</a>：</p>
<blockquote>
  <p>Reads Java class and interface definitions and compiles them into bytecode and class files.</p>
</blockquote>

<p>javac的语法如下：</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>javac <span class="o">[</span> options <span class="o">]</span> <span class="o">[</span> sourcefiles <span class="o">]</span> <span class="o">[</span> classes] <span class="o">[</span> @argfiles <span class="o">]</span>
</code></pre></div></div>
<ul>
  <li>options：是一些参数，比如-cp，-d</li>
  <li>sourcefiles：就是编译的java文件，如<code class="highlighter-rouge">HelloWorld.java</code>，可以是多个，并用空格隔开</li>
  <li>classes：用来处理处理注解。暂时没搞懂怎么用</li>
  <li>@argfiles，就是包含option或java文件列表的文件路径，用@符号开头，就像上面的@javaOptions.txt和@javaFiles.txt</li>
</ul>

<h1 id="总结">总结</h1>
<p>将<code class="highlighter-rouge">javac</code>的基本用法总结如下：</p>
<ol>
  <li><code class="highlighter-rouge">-cp</code>参数设置类路径，基本用法是将编译时依赖的jar包加入类路径。并可用<code class="highlighter-rouge">*</code>通配jar包。</li>
  <li><code class="highlighter-rouge">-d</code> 参数用来设置class文件编译到单独目录，并根据包名创建子目录。</li>
  <li>理论上将java文件的路径全部传给<code class="highlighter-rouge">javac</code>即可，但操作上，可以通过find命令将文件列表输出到文件中，通过@argfiles参数传递。</li>
</ol>

<h1 id="参考">参考</h1>
<ol>
  <li>https://docs.oracle.com/javase/8/docs/technotes/tools/unix/javac.html</li>
  <li>https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html</li>
  <li>https://docs.oracle.com/javase/8/docs/technotes/tools/unix/classpath.html</li>
  <li>https://docs.oracle.com/javase/tutorial/getStarted/problems/index.html</li>
  <li>http://docs.oracle.com/javase/8/docs/technotes/tools/findingclasses.html</li>
</ol>

<blockquote>
  <p>本文转自我的知乎专栏<a href="https://zhuanlan.zhihu.com/java-linux">《Java与Linux学习周刊》</a>的<a href="https://zhuanlan.zhihu.com/p/74229762">《第1期：抛开IDE，了解一下javac如何编译》</a>。
<!--stackedit_data:
eyJoaXN0b3J5IjpbNDQ2MTQ0MTgwXX0=
--></p>
</blockquote>
